require(ggplot2)
require(data.table)
require(gridExtra)

nan = NA;
lls_small_t_truncated = vector(mode="list", length=1);
lls_small_t_full = vector(mode="list", length=1);
lls_analytic = vector(mode="list", length=1);
ts = vector(mode="list", length=1);
small_ts = rep(NA, 1);
x_0_tilde=1.00000000000000e-01;
y_0_tilde=1.00000000000000e-01;
x_t_tilde=5.00000000000000e-01;
y_t_tilde=5.00000000000000e-01;
sigma_y_tilde=5.00000000000000e-01;
t_tilde=5.81497000000000e-02;
rho=0.00000000000000e+00;
log_likelihood=-4.32267567159303e+00;
FLIPPED=0;
lls_small_t_truncated[[1]] = c(-9.13018553736157e+02,-8.49153214455415e+02,-7.89629228966887e+02,-7.34153094924246e+02,-6.82451152553645e+02,-6.34268243173197e+02,-5.89366458404812e+02,-5.47523973947055e+02,-5.08533962192165e+02,-4.72203578356878e+02,-4.38353015157079e+02,-4.06814621392283e+02,-3.77432080119260e+02,-3.50059642386195e+02,-3.24561412771158e+02,-3.00810683222587e+02,-2.78689311936275e+02,-2.58087144224106e+02,-2.38901472535646e+02,-2.21036532985615e+02,-2.04403035919206e+02,-1.88917728214094e+02,-1.74502985173540e+02,-1.61086430010027e+02,-1.48600579054174e+02,-1.36982510949702e+02,-1.26173558212880e+02,-1.16119019644444e+02,-1.06767892184261e+02,-9.80726208942661e+01,-8.99888658441021e+01,-8.24752847567257e+01,-7.54933303485100e+01,-6.90070613703691e+01,-6.29829664235237e+01,-5.73897996858733e+01,-5.21984277425633e+01,-4.73816867668267e+01,-4.29142493435699e+01,-3.87725002668271e+01,-3.49344206711240e+01,-3.13794798744922e+01,-2.80885343180183e+01,-2.50437329879669e+01,-2.22284287113875e+01,-1.96270947389121e+01,-1.72252460849390e+01,-1.50093651978705e+01,-1.29668316848596e+01,-1.10858560071518e+01,-9.35541727079750e+00,-7.76520543050107e+00,-6.30556836495179e+00,-4.96746433640301e+00,-3.74242029072589e+00,-2.62249627532615e+00,-1.60025595647221e+00,-6.68742829139063e-01,1.78538723789774e-01,9.47638786591625e-01,1.64417527282383e+00,2.27334705123145e+00,2.83994853735679e+00,3.34838716387153e+00,3.80270465254280e+00,4.20660239597238e+00,4.56347061915660e+00,4.87642042879394e+00,5.14831744511494e+00,5.38181548080776e+00,5.57938868110235e+00,5.74336064032577e+00,5.87592922675192e+00,5.97918614710457e+00,6.05513064251207e+00,6.10567711561448e+00,6.13265693232470e+00,6.13781510266713e+00,6.12280298935160e+00,6.08916856874913e+00,6.03834601300570e+00,5.97164641295618e+00,5.89025128127564e+00,5.79521006842462e+00,5.68744234617774e+00,5.56774466374043e+00,5.43680147720073e+00,5.29519909840287e+00,5.14344136751404e+00,4.98196573463626e+00,4.81115860211555e+00,4.63136906381821e+00,4.44292050699158e+00,4.24611985447477e+00,4.04126447951658e+00,3.82864700457614e+00,3.60855829975088e+00,3.38128903780258e+00,3.14713015791097e+00,2.90637255613678e+00);
lls_small_t_full[[1]] = c(-9.13018553736157e+02,-8.49153214455415e+02,-7.89629228966887e+02,-7.34153094924246e+02,-6.82451152553645e+02,-6.34268243173197e+02,-5.89366458404812e+02,-5.47523973947055e+02,-5.08533962192165e+02,-4.72203578356878e+02,-4.38353015157079e+02,-4.06814621392283e+02,-3.77432080119260e+02,-3.50059642386195e+02,-3.24561412771158e+02,-3.00810683222587e+02,-2.78689311936275e+02,-2.58087144224106e+02,-2.38901472535646e+02,-2.21036532985615e+02,-2.04403035919206e+02,-1.88917728214094e+02,-1.74502985173540e+02,-1.61086430010027e+02,-1.48600579054174e+02,-1.36982510949702e+02,-1.26173558212880e+02,-1.16119019644444e+02,-1.06767892184261e+02,-9.80726208942661e+01,-8.99888658441021e+01,-8.24752847567257e+01,-7.54933303485100e+01,-6.90070613703691e+01,-6.29829664235237e+01,-5.73897996858733e+01,-5.21984277425633e+01,-4.73816867668267e+01,-4.29142493435699e+01,-3.87725002668271e+01,-3.49344206711240e+01,-3.13794798744922e+01,-2.80885343180183e+01,-2.50437329879669e+01,-2.22284287113875e+01,-1.96270947389121e+01,-1.72252460849390e+01,-1.50093651978705e+01,-1.29668316848596e+01,-1.10858560071518e+01,-9.35541727079750e+00,-7.76520543050107e+00,-6.30556836495179e+00,-4.96746433640301e+00,-3.74242029072589e+00,-2.62249627532615e+00,-1.60025595647221e+00,-6.68742829139063e-01,1.78538723789774e-01,9.47638786591625e-01,1.64417527282383e+00,2.27334705123145e+00,2.83994853735679e+00,3.34838716387153e+00,3.80270465254280e+00,4.20660239597238e+00,4.56347061915660e+00,4.87642042879394e+00,5.14831744511494e+00,5.38181548080776e+00,5.57938868110235e+00,5.74336064032577e+00,5.87592922675192e+00,5.97918614710457e+00,6.05513064251207e+00,6.10567711561448e+00,6.13265693232470e+00,6.13781510266713e+00,6.12280298935160e+00,6.08916856874913e+00,6.03834601300570e+00,5.97164641295618e+00,5.89025128127564e+00,5.79521006842462e+00,5.68744234617774e+00,5.56774466374043e+00,5.43680147720073e+00,5.29519909840287e+00,5.14344136751404e+00,4.98196573463626e+00,4.81115860211555e+00,4.63136906381821e+00,4.44292050699158e+00,4.24611985447477e+00,4.04126447951658e+00,3.82864700457614e+00,3.60855829975088e+00,3.38128903780258e+00,3.14713015791097e+00,2.90637255613678e+00);
lls_analytic[[1]] = c(-nan,-8.54701949707086e+02,-7.95178220706399e+02,-7.39702361798823e+02,-6.88000714570092e+02,-6.39818121797608e+02,-5.94916676669688e+02,-5.53074556566384e+02,-5.14084935685072e+02,-4.77754971180505e+02,-4.43904857849402e+02,-4.12366946725635e+02,-3.82984923265382e+02,-3.55613041093726e+02,-3.30115407556522e+02,-3.06365317575343e+02,-2.84244632540063e+02,-2.63643201194439e+02,-2.44458319675887e+02,-2.26594228062611e+02,-2.09961640960172e+02,-1.94477309826481e+02,-1.80063614889779e+02,-1.66648184659230e+02,-1.54163541163023e+02,-1.42546769175032e+02,-1.31739207808628e+02,-1.21686162965959e+02,-1.12336639233224e+02,-1.03643089907806e+02,-9.55611839320670e+01,-8.80495885914692e+01,-8.10697669120117e+01,-7.45857887640352e+01,-6.85641547465890e+01,-6.29736319889917e+01,-5.77851010639141e+01,-5.29714132589235e+01,-4.85072575000247e+01,-4.43690362599540e+01,-4.05347498144978e+01,-3.69838882320340e+01,-3.36973304984700e+01,-3.06572502010129e+01,-2.78470272351904e+01,-2.52511650790070e+01,-2.28552133113977e+01,-2.06456952413691e+01,-1.86100407396516e+01,-1.67365245817167e+01,-1.50142107567796e+01,-1.34329032073014e+01,-1.19831032938734e+01,-1.06559739299953e+01,-9.44330985317663e+00,-8.33751299512619e+00,-7.33157151112122e+00,-6.41904083880433e+00,-5.59402523657185e+00,-4.85115858005217e+00,-4.18558367923692e+00,-3.59292989115831e+00,-3.06928923100638e+00,-2.61119146915302e+00,-2.21557884752739e+00,-1.87978110635047e+00,-1.60149154296081e+00,-1.37874486982295e+00,-1.20989770312432e+00,-1.09361256412832e+00,-1.02884625749839e+00,-1.01484334845402e+00,-1.05113516161696e+00,-1.13754427938290e+00,-1.27419398844214e+00,-1.46152161433103e+00,-1.70029431653736e+00,-1.99162578907327e+00,-2.33699246237884e+00,-2.73824819334138e+00,-3.19763695744266e+00,-3.71780359056399e+00,-4.30180305804384e+00,-4.95310899765953e+00,-5.67562239056670e+00,-6.47368119724886e+00,-7.35207170312851e+00,-8.31604219164453e+00,-9.37131942783608e+00,-1.05241283077653e+01,-1.17812149175773e+01,-1.31498731572006e+01,-1.46379750211329e+01,-1.62540045961978e+01,-1.80070958324662e+01,-1.99070741147853e+01,-2.19645018494723e+01,-2.41907276879402e+01,-2.65979414435552e+01,-2.91992480734500e+01);
ts[[1]] = c(6.73794699908547e-03,7.22650328137646e-03,7.75048389113670e-03,8.31245738192313e-03,8.91517854843956e-03,9.56160193054352e-03,1.02548962964040e-02,1.09984601758069e-02,1.17959385197516e-02,1.26512405680053e-02,1.35685590122010e-02,1.45523905484162e-02,1.56075579199829e-02,1.67392335585807e-02,1.79529649395029e-02,1.92547017753870e-02,2.06508251817126e-02,2.21481789570374e-02,2.37541031313051e-02,2.54764699466811e-02,2.73237224472926e-02,2.93049158670408e-02,3.14297620183678e-02,3.37086768995725e-02,3.61528317540465e-02,3.87742078317221e-02,4.15856551211733e-02,4.46009553402746e-02,4.78348894941985e-02,5.13033103319192e-02,5.50232200564073e-02,5.90128536694479e-02,6.32917683596408e-02,6.78809393717615e-02,7.28028628274356e-02,7.80816660011532e-02,8.37432255921960e-02,8.98152945722477e-02,9.63276382304930e-02,1.03312180083100e-01,1.10803158362334e-01,1.18837293852410e-01,1.27453969894821e-01,1.36695425445524e-01,1.46606962130350e-01,1.57237166313628e-01,1.68638147268595e-01,1.80865792617122e-01,1.93980042290892e-01,2.08045182357020e-01,2.23130160148430e-01,2.39308922243755e-01,2.56660776953556e-01,2.75270783089752e-01,2.95230166924014e-01,3.16636769379053e-01,3.39595525644939e-01,3.64218979571523e-01,3.90627835358521e-01,4.18951549247639e-01,4.49328964117222e-01,4.81908990090203e-01,5.16851334491700e-01,5.54327284734507e-01,5.94520547970195e-01,6.37628151621774e-01,6.83861409212356e-01,7.33446956224290e-01,7.86627861066554e-01,8.43664816596384e-01,9.04837418035960e-01,9.70445533548509e-01,1.04081077419239e+00,1.11627807045887e+00,1.19721736312181e+00,1.28402541668774e+00,1.37712776433596e+00,1.47698079388264e+00,1.58407398499448e+00,1.69893230861855e+00,1.82211880039051e+00,1.95423732063594e+00,2.09593551449437e+00,2.24790798667647e+00,2.41089970641721e+00,2.58570965931585e+00,2.77319476396430e+00,2.97427407256307e+00,3.18993327611619e+00,3.42122953628968e+00,3.66929666761925e+00,3.93535069547048e+00,4.22069581699656e+00,4.52673079431426e+00,4.85495581123744e+00,5.20697982717986e+00,5.58452846427607e+00,5.98945246638313e+00,6.42373677142915e+00,6.88951024158131e+00);
small_ts[1] = 7.17897987691853e-02;
t_tilde_0=5.81497000000000e-02;
plot.data = data.table(log_likelihood=lls_small_t_truncated[[1]],
		 log_t=log(ts[[1]]),
		 type=rep("Truncated small-time solution", length(lls_small_t_truncated[[1]])));
plot.data = rbind(plot.data, data.table(log_likelihood=lls_analytic[[1]], log_t=log(ts[[1]]), type=rep("Analytic solution", length(lls_analytic[[1]]))));
g = ggplot(data=plot.data, aes(y=log_likelihood, x=log_t, group=type)) + 
		 geom_line(aes(linetype=type, color=type), size=1) + 
		 xlab(expression(log(tilde(t)))) + ylab("log likelihood") + 
		 geom_vline(xintercept=log(small_ts[[1]]), color="red");
ggsave(filename="~/PDE-solvers/src/kernel-expansion/documentation/chapter-3/figures/chapter-3-figure-illustration-likelihood-profile.pdf",plot=g, width=6.5, height=6.5, units="in");
